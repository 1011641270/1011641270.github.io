---
layout: default
title: Java 中的垃圾回收策略
---


## 垃圾回收需要解决的问题

* 谁需要被回收
* 什么时候回收
* 怎么回收

## 谁需要被回收

如果一个对象再也不会被用到，就可以回收它了，所以关键在于如何知道一个对象再也不被使用了。

* 引用计数

当一个对象被引用时，引用计数加1，当引用失效时，计数减1。简单直观，但会出现循环引用问题。

```java
a.tb = b
b.ta = a
```

即使 `a` 和 `b` 再也不会被用到了，但他们之间互相引用，导致引用计数一直不为0，无法被回收。

* 可达性分析

Java, C# 的主流实现都是使用可达性分析来判断一个对象是否存活的。如果从 `GC Root` 可以到达一个对象，那么
这个对象是可达的，还存活着，否则就不存活，可以被回收。 `GC Root` 包含以下几类。

1. 虚拟机栈引用的对象
2. 方法区静态属性引用的对象
3. 方法区中常量引用的对象
4. 本地方法栈中JNI引用的对象

## 何时及如何回收

何时及如何回收，涉及具体的回收策略，就放一起说了。

* 标记回收

最基本的垃圾回收算法，第一次扫描，标记所有可以被回收的对象，第二次扫描，回收被标记的对象。

不足之处

1. 效率低
2. 会产生内存碎片 


